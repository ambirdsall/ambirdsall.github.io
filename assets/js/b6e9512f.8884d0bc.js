"use strict";(self.webpackChunkambirdsall_com=self.webpackChunkambirdsall_com||[]).push([[6859],{622:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"noisebot/scripting","title":"Automating Sonos actions with node.js","description":"Caveat lector: this page is about as finished as that freeway overpass in Speed (1994)","source":"@site/projects/noisebot/scripting.mdx","sourceDirName":"noisebot","slug":"/noisebot/scripting","permalink":"/projects/noisebot/scripting","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"projectSidebar","previous":{"title":"Setting Up The Rasperry Pi Zero W","permalink":"/projects/noisebot/raspberry-pi-zero"},"next":{"title":"on-the-sierpinski-triangle-thing","permalink":"/projects/on-the-sierpinski-triangle-thing"}}');var i=t(4848),s=t(8453);const r={},a="Automating Sonos actions with node.js",c={},d=[{value:"A view of the program from 10,000 feet",id:"a-view-of-the-program-from-10000-feet",level:2},{value:"Aside: picking the right fights",id:"aside-picking-the-right-fights",level:3},{value:"Discover all Sonos devices on local network",id:"discover-all-sonos-devices-on-local-network",level:2},{value:"Defining key listeners cleanly",id:"defining-key-listeners-cleanly",level:2},{value:"Adding a REPL right from the start: a decision that payed off over and over and over again",id:"adding-a-repl-right-from-the-start-a-decision-that-payed-off-over-and-over-and-over-again",level:2},{value:"defining user-triggered actions",id:"defining-user-triggered-actions",level:2},{value:"A reminder which keys I was listening for and what each does",id:"a-reminder-which-keys-i-was-listening-for-and-what-each-does",level:3},{value:"<code>p</code>: ensure the audio source for the <code>Connect:Amp</code> device (and any other speakers in its group) is the line in.",id:"p-ensure-the-audio-source-for-the-connectamp-device-and-any-other-speakers-in-its-group-is-the-line-in",level:3},{value:"<code>l</code>, <code>t</code>, <code>k</code>: toggle a specific other device&#39;s membership in the <code>Connect:Amp</code>&#39;s group",id:"l-t-k-toggle-a-specific-other-devices-membership-in-the-connectamps-group",level:3},{value:"<code>b</code>, <code>f</code>: change tracks when streaming from software",id:"b-f-change-tracks-when-streaming-from-software",level:4},{value:"<code>u</code>, <code>d</code>: volume up or down",id:"u-d-volume-up-or-down",level:4},{value:"<code>m</code>: toggle mute",id:"m-toggle-mute",level:4}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",sup:"sup",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"automating-sonos-actions-with-nodejs",children:"Automating Sonos actions with node.js"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Caveat lector:"})," this page is about as finished as that freeway overpass in ",(0,i.jsx)(n.em,{children:"Speed (1994)"})]})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:['"Line In" could mean a few different things in the context of my Sonos system: its the label for the ',(0,i.jsx)(n.code,{children:"Connect:Amp"})," device in my home Sonos system, it can refer to the eponymous input jack",(0,i.jsx)(n.sup,{children:(0,i.jsx)(n.a,{href:"#user-content-fn-1",id:"user-content-fnref-1","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})," in back of that device, and it can refer to the audio input channel that serves as the software interface to the signal going through that jack. To disambiguate, I'll use ",(0,i.jsx)(n.code,{children:"Connect:Amp"}),' to refer to the device and "line in", lowercase, to refer to the jack and/or its associated audio input channel\u2014there is no meaningful distinction between the two within the software layer, and anywhere the distinction ',(0,i.jsx)(n.em,{children:"is"})," meaningful, it can be gleaned from context."]})}),"\n",(0,i.jsx)(n.h2,{id:"a-view-of-the-program-from-10000-feet",children:"A view of the program from 10,000 feet"}),"\n",(0,i.jsxs)(n.p,{children:["We have a preexisting Sonos system we want to act on; a keyboard as the physical UI for triggering actions; the ",(0,i.jsx)(n.code,{children:"sonos"})," npm package providing a node.js API for defining and executing those actions; and a Raspberry Pi Zero W to orchestrate it all."]}),"\n",(0,i.jsx)(n.mermaid,{value:"%%{ init: { 'flowchart': { 'curve': 'monotoneY' } } }%%\ngraph LR\n  Rpi[Operating System]\n  Script[[node.js script]]\n  Keeb[(Keyboard)]\n  Sonos@{ shape: processes, label: Sonos devices }\n  Keeb== character codes via USB cable ==> computing\n  computing-. send user commands over wifi .-> Sonos\n  subgraph computing [Raspberry Pi]\n    direction TB\n    Rpi-- forward each character code to script --\x3e Script\n    Script-- \"look up node.js functions based on character code\" --o Script\n    Script-- compose HTTP messages for user commands according to Sonos protocol --\x3e Rpi\n  end"}),"\n",(0,i.jsx)(n.p,{children:"The software running on the Raspberry Pi contained most of the complexity and problems that needed to be solved; it also has some initialization steps missing from that high-level diagram of the running controller's behaviors. Here, then, is a more detailed view of what all needs to happen when that node.js script starts up:"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant SonosNetwork\n    participant Program\n    participant Keyboard\n\n    Program->>SonosNetwork: Scan for Sonos devices on local network\n    SonosNetwork->>Program: Get list of currently-connected devices\n    Program->>Program: Define user-triggered interactions with specific devices\n    Program->>Program: Begin listening for specific keys\n    Keyboard->>Program: Send a keycode\n    Program->>SonosNetwork: Run corresponding function\n    Keyboard->>Program: Send a keycode\n    Program->>SonosNetwork: Run corresponding function\n    Keyboard->>Program: Send a keycode\n    Program->>SonosNetwork: You get the idea"}),"\n",(0,i.jsx)(n.h3,{id:"aside-picking-the-right-fights",children:"Aside: picking the right fights"}),"\n",(0,i.jsx)(n.p,{children:"This being a personal hobby project, I decided on a few specific tradeoffs upfront:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["manual testing > test code","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["unit tests et al. are great for validating code's behavior ",(0,i.jsx)(n.em,{children:"within"})," API boundaries",(0,i.jsx)(n.sup,{children:(0,i.jsx)(n.a,{href:"#user-content-fn-2",id:"user-content-fnref-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"2"})}),", but the correctness of this project's code depends almost entirely on its effects ",(0,i.jsx)(n.em,{children:"across"})," the boundary of Sonos' HTTP API; the cost/benefit of test code is wrong for this specific project."]}),"\n",(0,i.jsx)(n.li,{children:"the biggest benefit of test code is how its correctness guarantees, however flawed, can scale across multiple developers and long time frames; this project involved neither."}),"\n",(0,i.jsx)(n.li,{children:"interactive affordances like REPLs should be aggressively sought out: by shortening the feedback loops of manual and exploratory testing, they act as multipliers on development speed, leverage, and confidence even where test code dare not go"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"K.I.S.S.: minimize dependencies and tooling requirements"}),"\n",(0,i.jsxs)(n.li,{children:["javascript, not typescript","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["static types are wonderful tools for globally enforcing low-grade correctness across multiple developers and long time frames",(0,i.jsx)(n.sup,{children:(0,i.jsx)(n.a,{href:"#user-content-fn-3",id:"user-content-fnref-3","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"3"})}),", but, well, cf. above on testing"]}),"\n",(0,i.jsx)(n.li,{children:"introducing a compilation step adds complexity, extra dependencies, and additional tooling requirements, and, well, cf. K.I.S.S. above"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:'code that is in any way Sonos-specific should prefer "good enough" and terse, ad hoc problem solving over theoretical portability; only bother spending time on clean, reusable abstractions for things that could be useful in wildly different projects, like "trigger arbitrary functions by typing keys" and "setup a REPL for connecting with the running program from another process, with access to its actual functions and values".'}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"These may not be the right choices for you, and they certainly aren't the same tradeoffs I would choose in a professional setting, but they were the right ones for this project. So, with that preamble out of the way, let's dig into how the code actually handles all those things that need to happen."}),"\n",(0,i.jsx)(n.h2,{id:"discover-all-sonos-devices-on-local-network",children:"Discover all Sonos devices on local network"}),"\n",(0,i.jsxs)(n.p,{children:["Better get ready to ",(0,i.jsx)(n.code,{children:"await"}),", because the devices being discovered are other IP addresses on the local wifi subnet, and network I/O is fundamentally async. I used the ",(0,i.jsx)(n.code,{children:"sonos"})," package's ",(0,i.jsx)(n.code,{children:"AsyncDeviceDiscovery"})," API. Here's a very simple example of how to use it:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"async function findDevices() {\n  return await new AsyncDeviceDiscovery().discoverMultiple()\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["By default, this returns an array of device objects, arbitrarily-ordered, with asynchronous methods for querying their identity and metadata, sending command messages, etc. It's a reasonable, very use-case-agnostic implementation decision for the ",(0,i.jsx)(n.code,{children:"sonos"})," package, but it's nowhere near optimal for my use case: I'm sending predefined commands to predefined devices, and I don't really want to deal with iterating over an anonymous list running async queries every time I want to find a specific device. Instead, with a little pre-processing, I can give myself something much nicer to work with. For most purposes I made an object ",(0,i.jsx)(n.code,{children:"rooms"}),", with cleaned-up versions of the device names defined in Sonos as its keys and the corresponding device wrappers (with their pre-fetched metadata) its values, and (largely for debugging) I decided to keep another reference to the flat list of devices as ",(0,i.jsx)(n.code,{children:"devices"}),", too. Device references were grouped into a destructuring-friendly return object:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"async function findDevices() {\n  let devices = await new AsyncDeviceDiscovery().discoverMultiple()\n  //\n  devices = await Promise.all(\n    devices.map(async (device) => {\n      // this contains useful stuff like the device name and IP\n      const deets = await device.deviceDescription()\n      return {device, deets}\n    })\n  )\n  // an object for looking up device objects by their camelcased room names\n  const rooms = devices.reduce(\n    (knownSpeakers, speaker) => ({\n      ...knownSpeakers,\n      [camelcase(speaker.deets.roomName)]: speaker,\n    }), {})\n  return { rooms, devices }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This is getting pretty close! I used ",(0,i.jsx)(n.em,{children:"extremely"})," similar code through several rounds of testing. However, networks are part of the real world, and the real world is flaky: sometimes a device randomly wouldn't be detected. If the dropped device is one the keyboard interacts with, we obviously have a problem, and if it's the line in we can't do squat; we also don't want device discovery to get caught in an infinite retry loop if one of the least-commonly-used speaker goes offline. I decided that the only device this gizmo truly can't do without is the ",(0,i.jsx)(n.code,{children:"Connect:Amp"}),", so I centered the retry logic on that, renamed the function to reflect it, and moved onto more important issues. Here's what I ended up with:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// extracted and closed over because no matter how many times I call `findLineInEtAl`,\n// there's no benefit to initializing this object more than once\nconst snoop = new AsyncDeviceDiscovery()\n\nasync function findLineInEtAl({ maxTries } = { maxTries: Infinity }) {\n  let rooms, devices\n  let attempts = 0\n  while (!rooms?.lineIn && attempts < maxTries) {\n    attempts = attempts + 1\n    process.stdout.write(rooms == null ? 'Finding rooms... ' : `Couldn't find \"Line In\" device, trying again... `)\n    devices = await snoop.discoverMultiple()\n    devices = await Promise.all(\n      devices.map(async (device) => {\n        const deets = await device.deviceDescription()\n        return {device, deets}\n      })\n    )\n    rooms = devices.reduce(\n      (knownSpeakers, speaker) => ({\n        ...knownSpeakers,\n        [camelcase(speaker.deets.roomName)]: speaker,\n      }), {})\n    console.log('\u2705')\n  }\n  if (!rooms?.lineIn && attempts >= maxTries) {\n    console.log(`shit man, i dunno, i can't find the line in box here`)\n    process.exit()\n  }\n  return { rooms, devices }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"With device object references in hand, or rather in scope, it was time to define some closures using them to execute user-triggered actions. First, though, a detour through the user input listener I wrote."}),"\n",(0,i.jsx)(n.h2,{id:"defining-key-listeners-cleanly",children:"Defining key listeners cleanly"}),"\n",(0,i.jsx)(n.p,{children:"Here were my goals for this slice of the system:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["process each individual character from the login shell's ",(0,i.jsx)(n.code,{children:"STDIN"})," immediately after it is typed"]}),"\n",(0,i.jsx)(n.li,{children:"expose an ergonomic API/DSL for defining the keymap, a set of character->function mappings"}),"\n",(0,i.jsx)(n.li,{children:"allow the keymap definition to be deferred until after device discovery is complete"}),"\n",(0,i.jsx)(n.li,{children:"avoid unnecessary dependencies, sticking to the JS stdlib and node's built-in modules wherever possible"}),"\n",(0,i.jsxs)(n.li,{children:['build a "keymap" object',(0,i.jsx)(n.sup,{children:(0,i.jsx)(n.a,{href:"#user-content-fn-4",id:"user-content-fnref-4","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"4"})})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"adding-a-repl-right-from-the-start-a-decision-that-payed-off-over-and-over-and-over-again",children:"Adding a REPL right from the start: a decision that payed off over and over and over again"}),"\n",(0,i.jsx)(n.p,{children:"I cannot stress this enough: give yourself ways to poke at your system interactively! It's a fast way to find bugs and stress test your assumptions, right as you work, and it's vastly more reliable than keeping it all in your head and trying The Think System \u2122."}),"\n",(0,i.jsxs)(n.p,{children:["That seemed awfully tricky to do here at first, since the Raspberry Pi this script was running on was headless, with only 6 keys on its keyboard and no screen; I couldn't just drop right into a breakpoint in the main thread. What I wanted instead was to be able to ssh in and ",(0,i.jsx)(n.em,{children:"then"})," connect with a running REPL server which exposed the same exact functions and variables I was using to identify and interact with speakers. This was remarkably, impressively easy to do in node! The trick was connecting over a unix socket using ",(0,i.jsx)(n.code,{children:"socat"}),". A wrapper script at ",(0,i.jsx)(n.code,{children:"bin/repl"})," saved me from having to remember the exact incantation; here it is, for reference:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"#!/usr/bin/env bash\n\nif command -v rlwrap >& /dev/null; then\n    rlwrap socat - UNIX-CONNECT:/tmp/noisebot-repl.sock\nelse\n    socat - UNIX-CONNECT:/tmp/noisebot-repl.sock\nfi\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"(There are nicer ways to deal with the socket filepath than hardcoding it, but there wasn't a compelling reason to spend the time doing so for this project.)"}),"\n",(0,i.jsx)(n.p,{children:"In any case, a way to connect is pointless with nothing to connect to; I still had to define the in-process REPL server I could connect to from a proper laptop over ssh."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const repl = require('node:repl')\nconst net = require('node:net')\n\nconst openRepl = (extraContext, replSocketPath = '/tmp/noisebot-repl.sock') => {\n  const replServer = net.createServer(socket => {\n    const r = repl.start({\n      input: socket,\n      output: socket,\n      terminal: true,\n      useColors: true,\n    })\n    Object.assign(r.context, extraContext)\n    r.on('exit', () => socket.end())\n  })\n  replServer.listen(replSocketPath)\n  console.log(`To interact with this process via a node repl, run '<noisebot directory>/bin/repl' in another tty`)\n  return replServer\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"openRepl"})," function returns the REPL server object in order that it can be properly cleaned up (with ",(0,i.jsx)(n.code,{children:"replServer.close()"}),") when the script exits."]}),"\n",(0,i.jsx)(n.p,{children:"With this, you can start the REPL as soon as all the values you want to make accessible inside the REPL are defined. For this project, I passed myself references to all the discovered devices, along with functions for user-triggered commands and group management, but you can use this technique with any values you can dream up; there's nothing Sonos-specific about the REPL management code per se:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const replServer = openRepl({\n  rooms,\n  ...rooms,\n  isInGroup,\n  forRoomsInGroup,\n  toggleRoom,\n  ensureLineInIsSource,\n  ensureRoomHasOwnGroup,\n})\n"})}),"\n",(0,i.jsx)(n.h2,{id:"defining-user-triggered-actions",children:"defining user-triggered actions"}),"\n",(0,i.jsx)(n.h3,{id:"a-reminder-which-keys-i-was-listening-for-and-what-each-does",children:"A reminder which keys I was listening for and what each does"}),"\n",(0,i.jsx)(n.p,{children:"After writing and installing custom firmware, here's the keyboard layout I had:"}),"\n",(0,i.jsxs)("svg",{viewBox:"0 0 260 120",width:"100%",height:"auto",xmlns:"http://www.w3.org/2000/svg",style:{maxWidth:"300px",margin:"2rem auto",display:"block"},children:[(0,i.jsx)("rect",{x:"10",y:"10",width:"50",height:"40",rx:"8",fill:"#eee",stroke:"#333"}),(0,i.jsx)("text",{x:"35",y:"35",fontSize:"16",textAnchor:"middle",fill:"#333",children:"b"}),(0,i.jsx)("rect",{x:"70",y:"10",width:"50",height:"40",rx:"8",fill:"#eee",stroke:"#333"}),(0,i.jsx)("text",{x:"95",y:"35",fontSize:"16",textAnchor:"middle",fill:"#333",children:"p"}),(0,i.jsx)("rect",{x:"130",y:"10",width:"50",height:"40",rx:"8",fill:"#eee",stroke:"#333"}),(0,i.jsx)("text",{x:"155",y:"35",fontSize:"16",textAnchor:"middle",fill:"#333",children:"f"}),(0,i.jsx)("rect",{x:"10",y:"70",width:"50",height:"40",rx:"8",fill:"#eee",stroke:"#333"}),(0,i.jsx)("text",{x:"35",y:"95",fontSize:"16",textAnchor:"middle",fill:"#333",children:"l"}),(0,i.jsx)("rect",{x:"70",y:"70",width:"50",height:"40",rx:"8",fill:"#eee",stroke:"#333"}),(0,i.jsx)("text",{x:"95",y:"95",fontSize:"16",textAnchor:"middle",fill:"#333",children:"t"}),(0,i.jsx)("rect",{x:"130",y:"70",width:"50",height:"40",rx:"8",fill:"#eee",stroke:"#333"}),(0,i.jsx)("text",{x:"155",y:"95",fontSize:"16",textAnchor:"middle",fill:"#333",children:"k"}),(0,i.jsx)("circle",{cx:"220",cy:"60",r:"35",fill:"#ccc",stroke:"#333",strokeWidth:"2"}),(0,i.jsx)("text",{x:"220",y:"48",fontSize:"14",textAnchor:"middle",fill:"#000",children:"\u21bb u"}),(0,i.jsx)("text",{x:"220",y:"65",fontSize:"14",textAnchor:"middle",fill:"#000",children:"\u21ba d"}),(0,i.jsx)("text",{x:"220",y:"81",fontSize:"12",textAnchor:"middle",fill:"#222",children:"(m)"})]}),"\n",(0,i.jsx)(n.p,{children:"Each keycode has a mnemonic meaning:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["top row: playback controls","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["left: ",(0,i.jsx)(n.code,{children:"b"}),"ackwards track"]}),"\n",(0,i.jsxs)(n.li,{children:["middle: ensure ",(0,i.jsx)(n.code,{children:"p"}),"honograph is audio source"]}),"\n",(0,i.jsxs)(n.li,{children:["right: ",(0,i.jsx)(n.code,{children:"f"}),"orwards track"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["bottom: device toggles","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"l"}),"iving room speaker"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"t"}),"v soundbar"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"k"}),"itchen speaker"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["knob:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["clockwise: ",(0,i.jsx)(n.code,{children:"u"}),"p volume"]}),"\n",(0,i.jsxs)(n.li,{children:["counterclockwise: ",(0,i.jsx)(n.code,{children:"d"}),"own volume"]}),"\n",(0,i.jsxs)(n.li,{children:["press: toggle ",(0,i.jsx)(n.code,{children:"m"}),"ute"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:'The actual keycodes going between keyboard and script could have been anything, and as long as both sides "agreed" on their meaning it would have no impact on real users\u2014but the mnemonics made it so much easier to do productive script development on a laptop keyboard before I had flashed custom keymappings to the keyboard firmware. Sticking to ordinary letters that were syntactically valid javascript property names without any need for escaping also made it very easy to write my key listeners in a friendly, readable DSL.'}),"\n",(0,i.jsxs)(n.h3,{id:"p-ensure-the-audio-source-for-the-connectamp-device-and-any-other-speakers-in-its-group-is-the-line-in",children:[(0,i.jsx)(n.code,{children:"p"}),": ensure the audio source for the ",(0,i.jsx)(n.code,{children:"Connect:Amp"})," device (and any other speakers in its group) is the line in."]}),"\n",(0,i.jsxs)(n.h3,{id:"l-t-k-toggle-a-specific-other-devices-membership-in-the-connectamps-group",children:[(0,i.jsx)(n.code,{children:"l"}),", ",(0,i.jsx)(n.code,{children:"t"}),", ",(0,i.jsx)(n.code,{children:"k"}),": toggle a specific other device's membership in the ",(0,i.jsx)(n.code,{children:"Connect:Amp"}),"'s group"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"if"})," device is currently in the group"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"then"}),": it leaves the group"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"else"}),": it joins the group\nfor this I can use ",(0,i.jsx)(n.code,{children:"sonos.joinGroup('Line In')"})," on other device objects to group with ",(0,i.jsx)(n.code,{children:"Line In"})]}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"b-f-change-tracks-when-streaming-from-software",children:[(0,i.jsx)(n.code,{children:"b"}),", ",(0,i.jsx)(n.code,{children:"f"}),": change tracks when streaming from software"]}),"\n",(0,i.jsxs)(n.h4,{id:"u-d-volume-up-or-down",children:[(0,i.jsx)(n.code,{children:"u"}),", ",(0,i.jsx)(n.code,{children:"d"}),": volume up or down"]}),"\n",(0,i.jsxs)(n.h4,{id:"m-toggle-mute",children:[(0,i.jsx)(n.code,{children:"m"}),": toggle mute"]}),"\n","\n",(0,i.jsxs)(n.section,{"data-footnotes":!0,className:"footnotes",children:[(0,i.jsx)(n.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{id:"user-content-fn-1",children:["\n",(0,i.jsxs)(n.p,{children:["Strictly speaking, it's a pair of stereo RCA jacks. ",(0,i.jsx)(n.a,{href:"#user-content-fnref-1","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{id:"user-content-fn-2",children:["\n",(0,i.jsxs)(n.p,{children:["This is even true of integration tests, which by definition test the software's behavior across some API boundary: in order to be useful and reliable, an integration test needs a controlled, repeatable setup and teardown of its test scenario, just like a unit test does. For this reason, integration tests are primarily helpful when they validate software's behavior across an ",(0,i.jsx)(n.em,{children:"internal"})," API boundary, still safely insulated from the slings and arrows of outrageous reality by the API boundary of the system as a whole. ",(0,i.jsx)(n.a,{href:"#user-content-fnref-2","data-footnote-backref":"","aria-label":"Back to reference 2",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{id:"user-content-fn-3",children:["\n",(0,i.jsxs)(n.p,{children:["If this makes static typing just sound like a lower-effort way to run halfassed unit tests on every line of your codebase, good! That's essentially what their value add is. ",(0,i.jsx)(n.a,{href:"#user-content-fnref-3","data-footnote-backref":"","aria-label":"Back to reference 3",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{id:"user-content-fn-4",children:["\n",(0,i.jsxs)(n.p,{children:["While static types aren't much practical benefit to this project (see above), they ",(0,i.jsx)(n.em,{children:"are"})," fun, and can be a useful tool for thinking through and communicating the domain (and assumptions!) of the program's possible data. If I wanted to define types for these keymaps, I would use something like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// The generic Keymap type. Extending an exhaustive union of single-character string types\n// instead of `string` would be more precise; but it would also be a huge pain to write\n// and a hot, verbose mess in the type checker\'s error messages.\ntype Keymap<Keycode> = Record<Key extends string & keyof Keycode, Function>\n\n// Refined for this program\'s use case:\ntype PlaybackControlKeycode = "b" | "p" | "f"\ntype RoomToggleKeycode = "t" | "l" | "k"\ntype VolumeCommandKeycode = "u" | "d" | "m"\ntype SonosKeycode = PlaybackControlKeycode | RoomToggleKeycode | VolumeCommandKeycode\n\nconst myCoolKeymap: Keymap<SonosKeycode> = ...\n'})}),"\n",(0,i.jsx)(n.a,{href:"#user-content-fnref-4","data-footnote-backref":"","aria-label":"Back to reference 4",className:"data-footnote-backref",children:"\u21a9"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var o=t(6540);const i={},s=o.createContext(i);function r(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);