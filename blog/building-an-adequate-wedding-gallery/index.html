<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Building An Adequate Wedding Gallery | Alex Birdsall</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ambirdsall.com/img/amb-icon.png"><meta data-rh="true" name="twitter:image" content="https://ambirdsall.com/img/amb-icon.png"><meta data-rh="true" property="og:url" content="https://ambirdsall.com/blog/building-an-adequate-wedding-gallery"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Building An Adequate Wedding Gallery | Alex Birdsall"><meta data-rh="true" name="description" content="A Cool-ass photo album"><meta data-rh="true" property="og:description" content="A Cool-ass photo album"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2016-11-29T00:00:00.000Z"><link data-rh="true" rel="icon" href="/img/amb-icon.png"><link data-rh="true" rel="canonical" href="https://ambirdsall.com/blog/building-an-adequate-wedding-gallery"><link data-rh="true" rel="alternate" href="https://ambirdsall.com/blog/building-an-adequate-wedding-gallery" hreflang="en"><link data-rh="true" rel="alternate" href="https://ambirdsall.com/blog/building-an-adequate-wedding-gallery" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://ambirdsall.com/blog/building-an-adequate-wedding-gallery","mainEntityOfPage":"https://ambirdsall.com/blog/building-an-adequate-wedding-gallery","url":"https://ambirdsall.com/blog/building-an-adequate-wedding-gallery","headline":"Building An Adequate Wedding Gallery","name":"Building An Adequate Wedding Gallery","description":"A Cool-ass photo album","datePublished":"2016-11-29T00:00:00.000Z","dateModified":"2025-04-24T23:03:37.000Z","author":[],"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://ambirdsall.com/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Alex Birdsall RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Alex Birdsall Atom Feed"><link rel="stylesheet" href="/assets/css/styles.981b19b4.css">
<script src="/assets/js/runtime~main.494a9538.js" defer="defer"></script>
<script src="/assets/js/main.e47f14a5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/amb-icon.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/amb-icon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/amb-icon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Home page</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog posts</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ambirdsall" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Github profile<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://linkedin.com/in/ambirdsall" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">LinkedIn profile<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://ambirdsall.com/resume" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">My resumé<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1"><article class=""><header><h1 class="title_f1Hy">Building An Adequate Wedding Gallery</h1><div class="container_mt6G margin-vert--md"><time datetime="2016-11-29T00:00:00.000Z">November 29, 2016</time> · <!-- -->5 min read</div></header><div id="__blog-post-container" class="markdown"><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="a-cool-ass-photo-album">A Cool-ass photo album<a href="#a-cool-ass-photo-album" class="hash-link" aria-label="Direct link to A Cool-ass photo album" title="Direct link to A Cool-ass photo album">​</a></h2>
<p>Our wedding photographer was a little slow in getting us our images, so I got
to thinking about what to do. I decided I wanted a static image gallery, and I
wanted it to be easy for anyone who came to get copies of photos they like,
whether for online use or making prints. For prints, people should be able to
download the high-resolution originals, and those are such big files, it makes
sense to zip the files before downloading. For digital use, there should be
smaller image files for download<sup><a href="#user-content-fn-1-cd8cae" id="user-content-fnref-1-cd8cae" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup>,
but that could easily be handled entirely client-side.</p>
<p>I decided that, in addition to normal &quot;download this photo&quot; usage, I wanted the
ability to</p>
<ol>
<li>Select any given subset of the images easily; and</li>
<li>Download that set of images as a zip file</li>
</ol>
<p>This is a kinda fun UI problem AND has a fun backend problem despite dealing
with static data. Which is great: since we&#x27;re not barring our photos from
anyone, there&#x27;s no need to implement any auth, which cuts out a big, common hassle right
from the get-go.</p>
<!-- -->
<p>The zipping part means there needs to be some server code running; I decided to use
a rails app hosted on elastic beanstalk. I was already hosting the images on
s3, and AWS designs all their services for easy interop (naturally, to keep all
your money going their way); besides, I had never hosted an app that way and I
wanted to learn.</p>
<p>Admittedly, for the initial version of this gallery, rails was overkill: just
within the world of ruby development, Sinatra would be plenty for just an image
gallery and a single zipping endpoint. But server-side overkill isn&#x27;t
necessarily bad: as lost as it&#x27;s fast and I don&#x27;t mind paying for it (let&#x27;s be
real, my family photos aren&#x27;t going to get millions of distinct views any day
soon), there&#x27;s no real downside<sup><a href="#user-content-fn-2-cd8cae" id="user-content-fnref-2-cd8cae" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup>. Besides:</p>
<ol>
<li>I have notions of extending the app with the ability to search and filter by
name, and rails makes building out the additional models down the line quite
straightforward; and</li>
<li>I wanted to practice working in and testing rails code for professional reasons</li>
</ol>
<p>So fuck it, rails it is.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="open-zipper">Open zipper?<a href="#open-zipper" class="hash-link" aria-label="Direct link to Open zipper?" title="Direct link to Open zipper?">​</a></h2>
<p>I searched for &quot;zip&quot; on <a href="https://www.ruby-toolbox.com/search?q=zip" target="_blank" rel="noopener noreferrer">Ruby
Toolbox</a>, and found two projects
that seemed to actually be intended for zipping files:</p>
<p><img decoding="async" loading="lazy" alt="Rubyzip gem stats" src="/assets/images/rubyzip-gem-stats-18fd07477a6e003498b99bba2a49af4b.png" width="1630" height="650" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="Zip gem stats" src="/assets/images/zip-gem-stats-436c77c08ace13dbf3a4077c044a1870.png" width="1616" height="660" class="img_ev3q"></p>
<p>I don&#x27;t know how a popularity rating is calculated, but it has a Science Beaker
icon, so it must be important. <a href="https://github.com/rubyzip/rubyzip" target="_blank" rel="noopener noreferrer">Rubyzip</a>,
it seems, is the gem for me.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="zip-it-up">Zip it up.<a href="#zip-it-up" class="hash-link" aria-label="Direct link to Zip it up." title="Direct link to Zip it up.">​</a></h2>
<p>That repo&#x27;s <code>README.md</code> has some intro-type example code:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">require</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;rubygems&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">require</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;zip&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">folder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;Users/me/Desktop/stuff_to_zip&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input_filenames </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-literal string" style="color:#e3116c">&#x27;image.jpg&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;description.txt&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;stats.csv&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zipfile_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;/Users/me/Desktop/archive.zip&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zip</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token builtin">File</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">zipfile_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Zip</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token builtin">File</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token constant" style="color:#36acaa">CREATE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">zipfile</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  input_filenames</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">each</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">filename</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Two arguments:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># - The name of the file as it will appear in the archive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># - The original file, including the path to find it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zipfile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> folder </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> filename</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  zipfile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_output_stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;myFile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">os</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write </span><span class="token string-literal string" style="color:#e3116c">&quot;myFile contains just this&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It&#x27;s not clear from the example alone what files do and don&#x27;t need to already
exist to get this to work. I fiddled around until I got a minimal POC working,
which looked something like this:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># In the Gemfile, mind, you need</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   gem &#x27;rubyzip&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">require</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;zip&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">folder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;/Users/ambirdsall/Desktop/actual_preexisting_directory&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input_filenames </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-literal string" style="color:#e3116c">&#x27;actual_preexisting_file.png&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zipfile_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;/Users/ambirdsall/Desktop/not_yet_existing_archive_file.zip&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zip</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token builtin">File</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">zipfile_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Zip</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token builtin">File</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token constant" style="color:#36acaa">CREATE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">zipfile</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  input_filenames</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">each</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">filename</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Two arguments:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># - The name of the file as it will appear in the archive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># - The original file, including the path to find it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zipfile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> folder </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> filename</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  zipfile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_output_stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;new_filename_for_streamed_data.txt&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">os</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write </span><span class="token string-literal string" style="color:#e3116c">&quot;I&#x27;m a dynamically-created plain text file&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To work inside a filesystem like this, <code>rubyzip</code> needs a full path to the
source files and the zipfile&#x27;s directory (that all throws a big error if the
path given to <code>zipfile.add</code> isn&#x27;t valid); but the <code>zipfile_name</code> doesn&#x27;t need to
exist yet.</p>
<p>More significantly, that <code>&quot;new_filename_for_streamed_data&quot;</code> business implies
that the filesystem can be skipped altogether for data which can be
streamed—from a database, say, <a href="https://github.com/ambirdsall/wedding_photos/blob/383ddcb249c657bfbf944533373d7d560cea11ab/app/actors/photo_fetcher.rb#L12-L16" target="_blank" rel="noopener noreferrer">or s3</a>.</p>
<p>This is plenty to work with: just get a list of selected images from the UI;
use that list to generate the corresponding s3 URLs; and then stream the
contents of each photo into a zipfile which is then sent to the user&#x27;s browser
for download. The <code>zipfile.get_output_stream</code> trick can be used for a friendly
index.txt file down the line, after I&#x27;ve mapped each photo to the names of the
people in it.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="coming-soon">Coming Soon...<a href="#coming-soon" class="hash-link" aria-label="Direct link to Coming Soon..." title="Direct link to Coming Soon...">​</a></h2>
<p>I&#x27;ll dive into the design of the UI and of the server code soon, each in its own post.</p>
<p>I whipped up some <code>imagemagick</code> scripts to do batch resizing and
optimizing, and hosted all the photos as public-read files in an s3 bucket.</p>
<p>Certainly nothing compared to sites that make you download megabytes of
javascript before the first paint on mobile.</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5 sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-1-cd8cae">
<a href="#user-content-fnref-1-cd8cae" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a>
</li>
<li id="user-content-fn-2-cd8cae">
<a href="#user-content-fnref-2-cd8cae" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a>
</li>
</ol>
</section><hr><br></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/zero-friction-testing-in-rails"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Zero-friction testing in rails</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/cron-legacy"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Cron: Legacy</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#a-cool-ass-photo-album" class="table-of-contents__link toc-highlight">A Cool-ass photo album</a></li><li><a href="#open-zipper" class="table-of-contents__link toc-highlight">Open zipper?</a></li><li><a href="#zip-it-up" class="table-of-contents__link toc-highlight">Zip it up.</a></li><li><a href="#coming-soon" class="table-of-contents__link toc-highlight">Coming Soon...</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">This site</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog index</a></li></ul></div><div class="col footer__col"><div class="footer__title">But more about me</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/ambirdsall" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://linkedin.com/in/ambirdsall" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ambirdsall.com/resume" target="_blank" rel="noopener noreferrer" class="footer__link-item">My resumé</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Alexander Birdsall</div></div></div></footer></div>
</body>
</html>