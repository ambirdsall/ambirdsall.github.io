<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.8"/><meta name="theme-color" content="#663399"/><style data-href="/styles.3766580290ad6adcdcca.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}header{margin-bottom:1.45rem}.plaid{background-color:#e9d4b9;background-image:repeating-linear-gradient(45deg,transparent 5px,rgba(11,36,45,.5) 0,rgba(11,36,45,.5) 10px,hsla(5,53%,63%,0) 0,hsla(5,53%,63%,0) 35px,hsla(5,53%,63%,.5) 0,hsla(5,53%,63%,.5) 40px,rgba(11,36,45,.5) 0,rgba(11,36,45,.5) 50px,rgba(11,36,45,0) 0,rgba(11,36,45,0) 60px,hsla(5,53%,63%,.5) 0,hsla(5,53%,63%,.5) 70px,rgba(247,179,85,.5) 0,rgba(247,179,85,.5) 80px,rgba(247,179,85,0) 0,rgba(247,179,85,0) 90px,hsla(5,53%,63%,.5) 0,hsla(5,53%,63%,.5) 110px,hsla(5,53%,63%,0) 0,hsla(5,53%,63%,0) 120px,rgba(11,36,45,.5) 0,rgba(11,36,45,.5) 140px),repeating-linear-gradient(135deg,transparent 5px,rgba(11,36,45,.5) 0,rgba(11,36,45,.5) 10px,hsla(5,53%,63%,0) 0,hsla(5,53%,63%,0) 35px,hsla(5,53%,63%,.5) 0,hsla(5,53%,63%,.5) 40px,rgba(11,36,45,.5) 0,rgba(11,36,45,.5) 50px,rgba(11,36,45,0) 0,rgba(11,36,45,0) 60px,hsla(5,53%,63%,.5) 0,hsla(5,53%,63%,.5) 70px,rgba(247,179,85,.5) 0,rgba(247,179,85,.5) 80px,rgba(247,179,85,0) 0,rgba(247,179,85,0) 90px,hsla(5,53%,63%,.5) 0,hsla(5,53%,63%,.5) 110px,hsla(5,53%,63%,0) 0,hsla(5,53%,63%,0) 140px,rgba(11,36,45,.5) 0,rgba(11,36,45,.5) 160px);color:hsla(0,0%,94%,.85)}header h1{font-size:3.14159em;font-weight:400;height:100%;letter-spacing:7px}header h1,header h3{margin:1em auto;max-width:70%;text-align:left}header>:first-child{height:100%;width:100%}header.plaid>:first-child{background:linear-gradient(90deg,transparent,rgba(82,89,90,.7) 15%,rgba(81,89,89,.7) 85%,transparent)}footer.plaid>:first-child{background:linear-gradient(90deg,transparent,rgba(82,89,90,.7) 40%,rgba(81,89,89,.7) 60%,transparent)}.icon-bar{margin:-1.5em auto 0;max-width:70%}.icon-bar>a{color:hsla(0,0%,94%,.85)}.icon-bar>a:hover{color:#246}.icon-bar>a>svg{font-size:2em;margin:1rem}.icon-bar>a>svg:first-of-type{margin-left:0}.shh{height:1px;left:-10000px;overflow:hidden;position:absolute;top:auto;width:1px}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:Muli,sans-serif}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wgUFxgxChuixQAAAEpJREFUGNNtjzEOwFAIQrHjv/9VcaWD2lpSF83TCAQPdiVEraKgTShBi1AFhlADaiyMZ9lnoZYb9av7yS/Il/w+dVk35tYtXHj8G+Flt1tNaV/oAAAAAElFTkSuQmCC);margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font:112.5%/1.45em georgia,serif;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{word-wrap:break-word;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:georgia,serif;font-kerning:normal;font-weight:400}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1{font-size:2.25rem}h1,h2{color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{word-wrap:normal;background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;margin:0 0 1.45rem;overflow:auto;padding:1.45rem}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{background:#e9e9d0;border-radius:3px;font-style:italic;margin:0 1.45rem 1.45rem;padding:11px}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.container{margin:0 auto;max-width:70%;padding:0 1.0875rem 1.45rem}@media only screen and (max-width:480px){.container{max-width:95%}}.token.operator{background:none}code[class*=language-],pre[class*=language-]{font-size:.8em}.post-link{font-size:.9em;margin:0 0 .5em 1em}.post-link:last-child{margin-bottom:1.3em}.post-link-date{color:#aaa;font-size:1.2em;margin-left:.62em;opacity:.6;vertical-align:sub}.triangle{align-items:center;display:flex;flex-direction:column;margin:3em 0 0}.triangle .resizer{opacity:0;opacity:.2;transition:opacity .5s ease}.touch-device .resizer,.triangle:hover .resizer{opacity:1}input[type=range]{-webkit-appearance:none;margin:10px 0;width:100%}input[type=range]:focus{outline:none}input[type=range]::-webkit-slider-runnable-track{animate:.2s;background:hsla(42,28%,54%,.26);border:1px solid rgba(34,68,102,.1);border-radius:5px;box-shadow:0 0 0 #000;cursor:pointer;height:8px;width:100%}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;background:#fff;border:1px solid rgba(34,68,102,.5);border-radius:15px;box-shadow:0 0 0 #000031;cursor:pointer;height:20px;margin-top:-7px;width:20px}input[type=range]:focus::-webkit-slider-runnable-track{background:hsla(42,28%,54%,.26)}input[type=range]::-moz-range-track{animate:.2s;background:hsla(42,28%,54%,.26);border:1px solid rgba(34,68,102,.1);border-radius:5px;box-shadow:0 0 0 #000;cursor:pointer;height:8px;width:100%}input[type=range]::-moz-range-thumb{background:#fff;border:1px solid rgba(34,68,102,.5);border-radius:15px;box-shadow:0 0 0 #000031;cursor:pointer;height:20px;width:20px}input[type=range]::-ms-track{animate:.2s;background:transparent;border-color:transparent;color:transparent;cursor:pointer;height:8px;width:100%}input[type=range]::-ms-fill-lower,input[type=range]::-ms-fill-upper{background:hsla(42,28%,54%,.26);border:0 solid #010101;border-radius:2px;box-shadow:0 0 0 #000}input[type=range]::-ms-thumb{background:#fff;border:1px solid rgba(34,68,102,.5);border-radius:15px;box-shadow:0 0 0 #000031;cursor:pointer;height:20px;margin-top:1px;width:20px}input[type=range]:focus::-ms-fill-lower,input[type=range]:focus::-ms-fill-upper{background:hsla(42,28%,54%,.26)}body{color:#246;font-family:Muli,sans-serif}h2{color:#888;font-size:2em;font-weight:400;margin:.5em 0}@media only screen and (max-width:480px){h2{font-size:1.6em}.subtitle{text-align:center}}h3{font-size:1.2em;font-weight:400;margin-bottom:.3em}a{color:#024}.blog-post-container{font-family:Century Schoolbook,serif;margin:auto;padding:0 10%}.blog-post-date{color:#dd9;margin-bottom:2em;margin-top:-2em}@media only screen and (max-width:480px){header h1{font-size:2.5em}header h1,header h3{max-width:90%}.blog-post-content h2{font-size:1.3em}}</style><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="icon" href="/favicon-32x32.png?v=e06ff3ac86a0c187840479eaa6cda49e" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=e06ff3ac86a0c187840479eaa6cda49e"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=e06ff3ac86a0c187840479eaa6cda49e"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=e06ff3ac86a0c187840479eaa6cda49e"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=e06ff3ac86a0c187840479eaa6cda49e"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=e06ff3ac86a0c187840479eaa6cda49e"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=e06ff3ac86a0c187840479eaa6cda49e"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=e06ff3ac86a0c187840479eaa6cda49e"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=e06ff3ac86a0c187840479eaa6cda49e"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="plaid"><div style="margin:0 auto;max-width:960px;padding:1.45rem 1.0875rem"><h1>Building An Adequate Wedding Gallery</h1><h3 class="blog-post-date">Tue Nov 29 2016</h3></div></header><div class="blog-post-container"><div class="blog-post"><div class="blog-post-content"><h2 id="a-cool-ass-photo-album" style="position:relative;"><a href="#a-cool-ass-photo-album" aria-label="a cool ass photo album permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A Cool-ass photo album</h2>
<p>Our wedding photographer was a little slow in getting us our images, so I got
to thinking about what to do. I decided I wanted a static image gallery, and I
wanted it to be easy for anyone who came to get copies of photos they like,
whether for online use or making prints. For prints, people should be able to
download the high-resolution originals, and those are such big files, it makes
sense to zip the files before downloading. For digital use, there should be
smaller image files for download<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>,
but that could easily be handled entirely client-side.</p>
<p>I decided that, in addition to normal "download this photo" usage, I wanted the
ability to</p>
<ol>
<li>Select any given subset of the images easily; and</li>
<li>Download that set of images as a zip file</li>
</ol>
<p>This is a kinda fun UI problem AND has a fun backend problem despite dealing
with static data. Which is great: since we're not barring our photos from
anyone, there's no need to implement any auth, which simplifies things.</p>
<p>The zipping part means there needs to be some server code running; I decided to use
a rails app hosted on elastic beanstalk. I was already hosting the images on
s3, and AWS designs all their services for easy interop (naturally, to keep all
your money going their way); besides, I had never hosted an app that way and I
wanted to learn.</p>
<p>Admittedly, for the initial version of this gallery, rails was overkill: just
within the world of ruby development, Sinatra would be plenty for just an image
gallery and a single zipping endpoint. But server-side overkill isn't
necessarily bad: as lost as it's fast and I don't mind paying for it (let's be
real, my family photos aren't going to get millions of distinct views any day
soon), there's no real downside<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>. Besides:</p>
<ol>
<li>I have notions of extending the app with the ability to search and filter by
name, and rails makes building out the additional models down the line quite
straightforward; and</li>
<li>I wanted to practice working in and testing rails code for professional reasons</li>
</ol>
<p>So fuck it, rails it is.</p>
<h2 id="open-zipper" style="position:relative;"><a href="#open-zipper" aria-label="open zipper permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Open zipper?</h2>
<p>I searched for "zip" on <a href="https://www.ruby-toolbox.com/search?q=zip">Ruby
Toolbox</a>, and found two projects
that seemed to actually be intended for zipping files:</p>
<p><img src="../../rubyzip-gem-stats.png" alt="Rubyzip gem stats"></p>
<p><img src="../../zip-gem-stats.png" alt="Zip gem stats"></p>
<p>I don't know how a popularity rating is calculated, but it has a Science Beaker
icon, so it must be important. <a href="https://github.com/rubyzip/rubyzip">Rubyzip</a>,
it seems, is the gem for me.</p>
<h2 id="zip-it-up" style="position:relative;"><a href="#zip-it-up" aria-label="zip it up permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Zip it up.</h2>
<p>That repo's <code class="language-text">README.md</code> has some intro-type example code:</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'rubygems'</span></span>
<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'zip'</span></span>

folder <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Users/me/Desktop/stuff_to_zip"</span></span>
input_filenames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'image.jpg'</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'description.txt'</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'stats.csv'</span></span><span class="token punctuation">]</span>

zipfile_name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"/Users/me/Desktop/archive.zip"</span></span>

Zip<span class="token double-colon punctuation">::</span><span class="token builtin">File</span><span class="token punctuation">.</span>open<span class="token punctuation">(</span>zipfile_name<span class="token punctuation">,</span> Zip<span class="token double-colon punctuation">::</span><span class="token builtin">File</span><span class="token double-colon punctuation">::</span><span class="token constant">CREATE</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>zipfile<span class="token operator">|</span>
  input_filenames<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>filename<span class="token operator">|</span>
    <span class="token comment"># Two arguments:</span>
    <span class="token comment"># - The name of the file as it will appear in the archive</span>
    <span class="token comment"># - The original file, including the path to find it</span>
    zipfile<span class="token punctuation">.</span>add<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> folder <span class="token operator">+</span> <span class="token string-literal"><span class="token string">'/'</span></span> <span class="token operator">+</span> filename<span class="token punctuation">)</span>
  <span class="token keyword">end</span>
  zipfile<span class="token punctuation">.</span>get_output_stream<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"myFile"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">|</span>os<span class="token operator">|</span> os<span class="token punctuation">.</span>write <span class="token string-literal"><span class="token string">"myFile contains just this"</span></span> <span class="token punctuation">}</span>
<span class="token keyword">end</span></code></pre></div>
<p>It's not clear from the example alone what files do and don't need to already
exist to get this to work. I fiddled around until I got a minimal POC working,
which looked something like this:</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># In the Gemfile, mind, you need</span>
<span class="token comment">#   gem 'rubyzip'</span>
<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'zip'</span></span>

folder <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"/Users/ambirdsall/Desktop/actual_preexisting_directory"</span></span>
input_filenames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'actual_preexisting_file.png'</span></span><span class="token punctuation">]</span>

zipfile_name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"/Users/ambirdsall/Desktop/not_yet_existing_archive_file.zip"</span></span>

Zip<span class="token double-colon punctuation">::</span><span class="token builtin">File</span><span class="token punctuation">.</span>open<span class="token punctuation">(</span>zipfile_name<span class="token punctuation">,</span> Zip<span class="token double-colon punctuation">::</span><span class="token builtin">File</span><span class="token double-colon punctuation">::</span><span class="token constant">CREATE</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>zipfile<span class="token operator">|</span>
  input_filenames<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>filename<span class="token operator">|</span>
    <span class="token comment"># Two arguments:</span>
    <span class="token comment"># - The name of the file as it will appear in the archive</span>
    <span class="token comment"># - The original file, including the path to find it</span>
    zipfile<span class="token punctuation">.</span>add<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> folder <span class="token operator">+</span> <span class="token string-literal"><span class="token string">'/'</span></span> <span class="token operator">+</span> filename<span class="token punctuation">)</span>
  <span class="token keyword">end</span>
  zipfile<span class="token punctuation">.</span>get_output_stream<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"new_filename_for_streamed_data.txt"</span></span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>os<span class="token operator">|</span>
    os<span class="token punctuation">.</span>write <span class="token string-literal"><span class="token string">"I'm a dynamically-created plain text file"</span></span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>To work inside a filesystem like this, <code class="language-text">rubyzip</code> needs a full path to the
source files and the zipfile's directory (that all throws a big error if the
path given to <code class="language-text">zipfile.add</code> isn't valid); but the <code class="language-text">zipfile_name</code> doesn't need to
exist yet.</p>
<p>More significantly, that <code class="language-text">"new_filename_for_streamed_data"</code> business implies
that the filesystem can be skipped altogether for data which can be
streamed—from a database, say, <a href="https://github.com/ambirdsall/wedding_photos/blob/383ddcb249c657bfbf944533373d7d560cea11ab/app/actors/photo_fetcher.rb#L12-L16">or s3</a>.</p>
<p>This is plenty to work with: just get a list of selected images from the UI;
use that list to generate the corresponding s3 URLs; and then stream the
contents of each photo into a zipfile which is then sent to the user's browser
for download. The <code class="language-text">zipfile.get_output_stream</code> trick can be used for a friendly
index.txt file down the line, after I've mapped each photo to the names of the
people in it.</p>
<h2 id="coming-soon" style="position:relative;"><a href="#coming-soon" aria-label="coming soon permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Coming Soon...</h2>
<p>I'll dive into the design of the UI and of the server code soon, each in its own post.</p>

      <div class="footnotes">
        <hr/>
        <ol >
    
    <li class="footnote-list-item" id="fn-1" >
          
        
      <a href="#fnref-1" class="footnote-backref" style="display:inline;text-decoration: none;">
        ↩
      </a>
    
      </li>
      
    
<p>I whipped up some <code class="language-text">imagemagick</code> scripts to do batch resizing and
optimizing, and hosted all the photos as public-read files in an s3 bucket.</p>

    <li class="footnote-list-item" id="fn-2" >
          
        
      <a href="#fnref-2" class="footnote-backref" style="display:inline;text-decoration: none;">
        ↩
      </a>
    
      </li>
      
    </ol></div>
<p>Certainly nothing compared to sites that make you download megabytes of
javascript before the first paint on mobile.</p></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blag/building-an-adequate-wedding-gallery";window.___webpackCompilationHash="eef5ccebb45f098c1803";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-29bef618359d4035cae1.js"]};/*]]>*/</script><script src="/app-29bef618359d4035cae1.js" async=""></script><script src="/1bfc9850-31a83d3e9b2d1d5a7a85.js" async=""></script><script src="/framework-94a7d1bc1fae8977e201.js" async=""></script><script src="/webpack-runtime-ad31a7b13803da6aeee4.js" async=""></script></body></html>