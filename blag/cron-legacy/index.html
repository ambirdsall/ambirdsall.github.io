<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.cc489e0c18131185481e.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}header{background-color:#e9d4b9;background-image:repeating-linear-gradient(45deg,transparent 5px,rgba(11,36,45,.5) 0,rgba(11,36,45,.5) 10px,rgba(211,119,111,0) 0,rgba(211,119,111,0) 35px,rgba(211,119,111,.5) 0,rgba(211,119,111,.5) 40px,rgba(11,36,45,.5) 0,rgba(11,36,45,.5) 50px,rgba(11,36,45,0) 0,rgba(11,36,45,0) 60px,rgba(211,119,111,.5) 0,rgba(211,119,111,.5) 70px,rgba(247,179,85,.5) 0,rgba(247,179,85,.5) 80px,rgba(247,179,85,0) 0,rgba(247,179,85,0) 90px,rgba(211,119,111,.5) 0,rgba(211,119,111,.5) 110px,rgba(211,119,111,0) 0,rgba(211,119,111,0) 120px,rgba(11,36,45,.5) 0,rgba(11,36,45,.5) 140px),repeating-linear-gradient(135deg,transparent 5px,rgba(11,36,45,.5) 0,rgba(11,36,45,.5) 10px,rgba(211,119,111,0) 0,rgba(211,119,111,0) 35px,rgba(211,119,111,.5) 0,rgba(211,119,111,.5) 40px,rgba(11,36,45,.5) 0,rgba(11,36,45,.5) 50px,rgba(11,36,45,0) 0,rgba(11,36,45,0) 60px,rgba(211,119,111,.5) 0,rgba(211,119,111,.5) 70px,rgba(247,179,85,.5) 0,rgba(247,179,85,.5) 80px,rgba(247,179,85,0) 0,rgba(247,179,85,0) 90px,rgba(211,119,111,.5) 0,rgba(211,119,111,.5) 110px,rgba(211,119,111,0) 0,rgba(211,119,111,0) 140px,rgba(11,36,45,.5) 0,rgba(11,36,45,.5) 160px);margin-bottom:1.45rem;color:#f0f0f0}header h1{font-weight:400;font-size:3.14159em;height:100%;letter-spacing:7px}header h1,header h3{margin:1em auto;text-align:left;max-width:70%}header>:first-child{background:-webkit-gradient(linear,left top,right top,from(transparent),color-stop(15%,hsla(0,0%,39.2%,.35)),color-stop(85%,hsla(0,0%,39.2%,.38)),to(transparent));background:linear-gradient(90deg,transparent,hsla(0,0%,39.2%,.35) 15%,hsla(0,0%,39.2%,.38) 85%,transparent);height:100%;width:100%}.icon-bar{margin:-1.5em auto 0;text-align:left;max-width:70%}.icon-bar>a{color:hsla(0,0%,94.1%,.85)}.icon-bar>a:hover{color:#246}.icon-bar>a>svg{font-size:2em;margin:1rem}.icon-bar>a>svg:first-of-type{margin-left:0}.blog-post-container{padding:0 10%;margin:auto;font-family:Century Schoolbook,serif}.blog-post-date{color:#dd9;margin-top:-2em;margin-bottom:2em}html{font-family:Muli,sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wgUFxgxChuixQAAAEpJREFUGNNtjzEOwFAIQrHjv/9VcaWD2lpSF83TCAQPdiVEraKgTShBi1AFhlADaiyMZ9lnoZYb9av7yS/Il/w+dVk35tYtXHj8G+Flt1tNaV/oAAAAAElFTkSuQmCC)}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:11px;margin:0 1.45rem 1.45rem;font-style:italic;background:#e9e9d0;border-radius:3px}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.token.operator{background:none}.post-link{margin:0 0 .5em 1em;font-size:.9em}.post-link:last-child{margin-bottom:1.3em}body{color:#246;font-family:Muli,sans-serif}h2{font-size:2em;margin:.5em 0;color:#888}h2,h3{font-weight:400}h3{font-size:1.2em;margin-bottom:.3em}a{color:#024}</style><meta name="generator" content="Gatsby 2.17.11"/><title data-react-helmet="true"></title><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="icon" href="/icons/icon-48x48.png?v=9bb68758799c2ce6b286a85541ea8320"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=9bb68758799c2ce6b286a85541ea8320"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=9bb68758799c2ce6b286a85541ea8320"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=9bb68758799c2ce6b286a85541ea8320"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=9bb68758799c2ce6b286a85541ea8320"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=9bb68758799c2ce6b286a85541ea8320"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=9bb68758799c2ce6b286a85541ea8320"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=9bb68758799c2ce6b286a85541ea8320"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=9bb68758799c2ce6b286a85541ea8320"/><link as="script" rel="preload" href="/webpack-runtime-bf2fc757b82430bd34cb.js"/><link as="script" rel="preload" href="/app-75bd719fadb82d957b9f.js"/><link as="script" rel="preload" href="/styles-211576318712ba2ed875.js"/><link as="script" rel="preload" href="/commons-34be4188256d824c5d28.js"/><link as="script" rel="preload" href="/component---src-templates-blog-template-js-912732f4999face1271e.js"/><link as="fetch" rel="preload" href="/page-data/blag/cron-legacy/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><header><div style="margin:0 auto;max-width:960px;padding:1.45rem 1.0875rem"><h1>Cron: Legacy</h1><h3 class="blog-post-date">Tue Oct 11 2016</h3></div></header><div class="blog-post-container"><div class="blog-post"><div class="blog-post-content"><p>I thought it would be cool to get my computer to automatically run <code class="language-text">brew
update</code> every so often in the background and email me if anything went wrong. I
thought it would be pretty simple! It was not, in fact, prety simple: I ran
into a bunch of super frustrating errors, usually because I was taking some
aspect of my normal terminal environment for granted (the <code class="language-text">$PATH</code> variable that
tells the shell where to look to find commands; email protocols and
authentication; ssh authentication; error handling in the shell; etc etc etc).</p>
<p>But I learned a bunch in the process! So kick back, pour yourself a drink, and
learn about <code class="language-text">cron</code>, the old-school unix tool you can use to run programs behind
your own back.</p>
<h2 id="what-is-a-cron-and-how-does-it-cron"><a href="#what-is-a-cron-and-how-does-it-cron" aria-label="what is a cron and how does it cron permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What is a <code class="language-text">cron</code> and how does it... cron?</h2>
<p>Cron is an old unix program used to run commands repeatedly on a schedule.
There are two main parts to the cron system: there is the cron daemon, a
program that (once set up) is constantly running in the background; and there
is the crontab file, which keeps the schedule of programs to run &#x3C;%=
<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>. Once every minute on the minute,
assuming your computer is awake and running, the cron daemon (the system
automatically launches <code class="language-text">cron</code> after you save your first valid crontab file, and
on boot afterwards) evaluates each line of all of the relevant installed
crontab files, running any commands whose schedules match on the current
minute. Any output to <code class="language-text">$STDERR</code> is assumed to be an error and is mailed to you:
<code class="language-text">cron</code>'s default mailing strategy is a local "mailbox" originally used for
pre-internet user-to-user messages within a multi-user system, but if you're
fancy with the google, it's pretty manageable to teach it to use something like
gmail instead.</p>
<h2 id="the-crontab-file"><a href="#the-crontab-file" aria-label="the crontab file permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The <code class="language-text">crontab</code> file</h2>
<p>You edit the crontab file with the command <code class="language-text">crontab -e</code>, regardless of where
you are in the filesystem. You need to do some config to use this; more on that
later.</p>
<p>Each line either contains a shell variable definition, in which case <code class="language-text">cron</code>
updates its environment accordingly<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>, or a
scheduled command. Scheduled commands are structured like this:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">* * * * *  /absolute/path/of/command/to/execute
│ │ │ │ │
│ │ │ │ └─── day of week (0 - 7) (0 to 6 are Sunday to Saturday, or use names; 7 is Sunday, the same as 0)
│ │ │ └──────── month (1 - 12)
│ │ └───────────── day of month (1 - 31)
│ └────────────────── hour (0 - 23)
└─────────────────────── min (0 - 59)</code></pre></div>
<p>For any element of a schedule (hours, minutes, etc), you can use:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">*  matches every value
-  defines a range, like `9-17` for every hour from 9AM to 5PM
,  separates multiple individual values, such as `MON,WED,FRI`</code></pre></div>
<p>So, for example <code class="language-text">0 9-17 * * 1-5</code> matches each hour from 9AM to 5PM on the hour,
each weekday, with no restrictions by month or day of month.</p>
<h2 id="editing-crontab-takes-special-config-because-life-is-suffering"><a href="#editing-crontab-takes-special-config-because-life-is-suffering" aria-label="editing crontab takes special config because life is suffering permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Editing <code class="language-text">crontab</code> takes special config, because life is suffering</h2>
<p>So <code class="language-text">crontab -e</code> opens the file with whatever your have set to <code class="language-text">$EDITOR</code> in your
shell session. I use vim, which is secretly a problem: the <code class="language-text">crontab</code> program
sets some rules about how you save the file, and vim's defaults work
differently.</p>
<p>Specifically, when vim writes changes to a file, it first saves them as a
backup file, then overwrites the original. This helps vim be more confident it
won't corrupt data if it crashes partway through writing, but <code class="language-text">crontab</code> won't
let you write to anything but the file itself, in-place. To get around this,
add to <code class="language-text">~/.vimrc</code>:</p>
<div class="gatsby-highlight" data-language="vim"><pre class="language-vim"><code class="language-vim"><span class="token builtin">autocmd</span> <span class="token keyword">filetype</span> crontab <span class="token keyword">setlocal</span> <span class="token builtin">nobackup</span> <span class="token builtin">nowritebackup</span></code></pre></div>
<p>&#x3C;%= section %q{<code class="language-text">cron</code> doesn't have a lot of things I took for granted about the shell environment} %></p>
<p>This isn't that bad to deal with once you get your head around it, but it took
me a while to realize just how much implicit environment I rely on when working
in a terminal. The main one is the <code class="language-text">$PATH</code> variable: for every command that
isn't built-in shell syntax, odds are good you'll need to prepend the <code class="language-text">/bin/</code>
or <code class="language-text">/usr/local/bin/</code> or <code class="language-text">/usr/sbin/</code> or what have you. If you don't know the
full path of some command you use a lot, for example, <code class="language-text">git</code>, pop open a
terminal and run <code class="language-text">which git</code>.</p>
<p>My first instinct was to make one of my <code class="language-text">crontab</code> file's first lines something like</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/Users/ambirdsall/bin:/usr/local/bin:/usr/bin:/bin:/I/dunno/maybe/sbin:/other/things/I'm/used/to/also</code></pre></div>
<p>If my crontab environment has access to all the same stuff I use everyday in my
terminal, then writing a cron command is just like writing any old terminal
command. But I think that's the wrong approach, for two reasons:</p>
<ol>
<li>Anything more complicated than a one-liner (and even many of those), you're
better off just saving in a shell script</li>
<li>If you succeed, you've just hidden from yourself how things work under the
hood AND made it easier for part of your terminal-based life to get out of
sync.</li>
</ol>
<p>If you feel a little lost when working with the full absolute paths of programs
and would like a better handle on why different programs live in <code class="language-text">/bin</code> vs
'/sbin' vs <code class="language-text">/usr/sbin</code> vs <code class="language-text">/usr/local/bin</code>—or even why some programs live in
more than one of those places—just run <code class="language-text">man hier</code> in your terminal and give it
a quick read.</p>
<h2 id="lets-put-almost-all-of-it-together"><a href="#lets-put-almost-all-of-it-together" aria-label="lets put almost all of it together permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Let's put almost all of it together</h2>
<p>Disclaimer: we're skipping over some hoops I had to jump through to send actual
emails to my gmail account from the command line (google it) and the way
thornier issue of how to authenticate an SSH connection with github (which is
where <code class="language-text">brew</code> searches for updates) in a bare-bones scripting environment
(google "askpass" or go <em>really</em> HAM and learn to use <code class="language-text">expect</code>). So:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">0</span> * * * * /usr/local/bin/brew update</code></pre></div>
<p>will run <code class="language-text">brew update</code> every hour on the hour, every single day, with zero
conscious effort on my part. Awesome! Awesome.</p>
<p>Wait, this <em>is</em> actually awesome, right?</p>
<p><img src="../../dumb-cron-error-email.png" alt="A dumb cron error email"></p>
<p>Goddamn it.</p>
<h2 id="okay-lets-just-go-through-one-of-the-dumb-problems"><a href="#okay-lets-just-go-through-one-of-the-dumb-problems" aria-label="okay lets just go through one of the dumb problems permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Okay, let's just go through <em>one</em> of the dumb problems</h2>
<p>Here's what was going on:</p>
<ol>
<li>If everything is up to date, <code class="language-text">brew</code> exits with a heads-up to <code class="language-text">$STDERR</code></li>
<li>Seeing a message in the error stream, <code class="language-text">cron</code> emailed me</li>
<li>I don't want email alerts every hour that things are still up-to-date</li>
</ol>
<p>So:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">/usr/local/bin/brew update <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">></span> /dev/null <span class="token operator">|</span> <span class="token function">grep</span> -v <span class="token string">'up-to-date'</span> <span class="token operator">></span><span class="token file-descriptor important">&amp;2</span></code></pre></div>
<p>First, a quick note: I use <code class="language-text">zsh</code>, not <code class="language-text">bash</code>, and there are a few differences
in how the two shells handle redirection, so if you use <code class="language-text">bash</code>, you might
need to make a few changes to get it working properly
<sup id="fnref-3"><a href="#fn-3" class="footnote-ref">3</a></sup>.  Let's break this down:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">></span> /dev/null</code></pre></div>
<p>The <code class="language-text">2&gt;&amp;1</code> redirects <code class="language-text">$STDERR</code> to <code class="language-text">$STDOUT</code>. The <code class="language-text">&gt; /dev/null</code> redirects
<code class="language-text">$STDOUT</code> to the Pit of Despair. If you think this seems like it will redirect
EVERYTHING to <code class="language-text">/dev/null</code>, leaving you nothing useful to work with, you think
like I do. But it doesn't! Whatever redirections you specify don't take effect
until the next pipe (or the end of the pipeline if there is no next pipe). It
makes sense: this system lets you redirect a bunch of things
<sup id="fnref-4"><a href="#fn-4" class="footnote-ref">4</a></sup> to each
others' old handles at the same time without having to worry too much about
overwriting important data streams because of accidental collisions along the
way.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">grep</span> -v <span class="token string">'up-to-date'</span></code></pre></div>
<p>So it's the contents of <code class="language-text">$STDERR</code> alone going through that pipe. Nice. <code class="language-text">grep</code>'s
<code class="language-text">-v</code> flag reverses the pattern, meaning lines that DON'T contain 'up-to-date'
are printed. Effectively, this filters out the 'up-to-date' error while letting
other errors pass through.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token operator">></span><span class="token file-descriptor important">&amp;2</span></code></pre></div>
<p>The last token there, <code class="language-text">&gt;&amp;2</code>, redirects this filtered error stream from <code class="language-text">$STDOUT</code>
back to <code class="language-text">$STDERR</code>; if anything else goes wrong, <code class="language-text">cron</code> will email as it should,
but it won't spam my inbox with nonsense just because I'm already good.</p>
<h3 id="nice"><a href="#nice" aria-label="nice permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NICE.</h3>
<p>Nice. Now go forth and automate the fuck out of some stuff!</p>

      <div class="footnotes">
        <hr/>
        <ol >
    
    <li class="footnote-list-item" id="fn-1" >
          
        <p class="footnote-paragraph" style="display:inline; ">Depending on your operating system, there might be both system-wide
crontabs and user-specific crontab files; I'm only going to discuss systems
with a single crontab file here.</p>
      <a href="#fnref-1" class="footnote-backref" style="display:inline;text-decoration: none;">
        ↩
      </a>
    
      </li>
      
    

    <li class="footnote-list-item" id="fn-2" >
          
        <p class="footnote-paragraph" style="display:inline; ">Setting <code>$SHELL</code>, <code>$PATH</code>, and <code>$MAILTO</code> correctly is quite important, and
worth some googling if you have questions.</p>
      <a href="#fnref-2" class="footnote-backref" style="display:inline;text-decoration: none;">
        ↩
      </a>
    
      </li>
      
    

    <li class="footnote-list-item" id="fn-3" >
          
        <p class="footnote-paragraph" style="display:inline; ">If you don't know what shell you're using, it's probably <code>bash</code>, but you
can check by running <code>echo $SHELL</code>.</p>
      <a href="#fnref-3" class="footnote-backref" style="display:inline;text-decoration: none;">
        ↩
      </a>
    
      </li>
      
    

    <li class="footnote-list-item" id="fn-4" >
          
        <p class="footnote-paragraph" style="display:inline; ">There's no rule that says <code>$STDIN</code>, <code>$STDOUT</code>, and <code>$STDERR</code> are the only
<a href="https://en.wikipedia.org/wiki/File_descriptor">file descriptors</a> your
process can have open, after all.</p>
      <a href="#fnref-4" class="footnote-backref" style="display:inline;text-decoration: none;">
        ↩
      </a>
    
      </li>
      
    </ol></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blag/cron-legacy";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-75bd719fadb82d957b9f.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js-912732f4999face1271e.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9b37774f8033162af493.js"],"component---src-pages-index-js":["/component---src-pages-index-js-4cc36656a18bb7ab0a96.js"]};/*]]>*/</script><script src="/component---src-templates-blog-template-js-912732f4999face1271e.js" async=""></script><script src="/commons-34be4188256d824c5d28.js" async=""></script><script src="/styles-211576318712ba2ed875.js" async=""></script><script src="/app-75bd719fadb82d957b9f.js" async=""></script><script src="/webpack-runtime-bf2fc757b82430bd34cb.js" async=""></script></body></html>